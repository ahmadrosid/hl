<table class="highlight-table">
<tbody>
<tr><td class="hl-num" data-line="1"></td><td><span class="hl-k">local</span> sfind = string.find</td></tr>
<tr><td class="hl-num" data-line="2"></td><td><span class="hl-k">local</span> ssub  = string.sub</td></tr>
<tr><td class="hl-num" data-line="3"></td><td></td></tr>
<tr><td class="hl-num" data-line="4"></td><td>---@param text string</td></tr>
<tr><td class="hl-num" data-line="5"></td><td><span class="hl-k">return</span> <span class="hl-k">function</span> (text)</td></tr>
<tr><td class="hl-num" data-line="6"></td><td>    <span class="hl-k">local</span> current = <span class="hl-c">1</span></td></tr>
<tr><td class="hl-num" data-line="7"></td><td>    <span class="hl-k">local</span> lines = {}</td></tr>
<tr><td class="hl-num" data-line="8"></td><td>    lines[<span class="hl-c">0</span>] = <span class="hl-c">1</span></td></tr>
<tr><td class="hl-num" data-line="9"></td><td>    <span class="hl-k">local</span> i = <span class="hl-c">0</span></td></tr>
<tr><td class="hl-num" data-line="10"></td><td>    <span class="hl-k">while</span> <span class="hl-c">true</span> <span class="hl-k">do</span></td></tr>
<tr><td class="hl-num" data-line="11"></td><td>        <span class="hl-k">local</span> pos = <span class="hl-en">sfind</span>(text,<span class="hl-s">'[\r\n]'</span>, current)</td></tr>
<tr><td class="hl-num" data-line="12"></td><td>        <span class="hl-k">if</span> <span class="hl-k">not</span> pos <span class="hl-k">then</span></td></tr>
<tr><td class="hl-num" data-line="13"></td><td>            <span class="hl-k">break</span></td></tr>
<tr><td class="hl-num" data-line="14"></td><td>        <span class="hl-k">end</span></td></tr>
<tr><td class="hl-num" data-line="15"></td><td>        i = i + <span class="hl-c">1</span></td></tr>
<tr><td class="hl-num" data-line="16"></td><td>        <span class="hl-k">if</span> <span class="hl-en">ssub</span>(text, pos, pos + <span class="hl-c">1</span>) == <span class="hl-s">'\r\n'</span> <span class="hl-k">then</span></td></tr>
<tr><td class="hl-num" data-line="17"></td><td>            current = pos + <span class="hl-c">2</span></td></tr>
<tr><td class="hl-num" data-line="18"></td><td>        <span class="hl-k">else</span></td></tr>
<tr><td class="hl-num" data-line="19"></td><td>            current = pos + <span class="hl-c">1</span></td></tr>
<tr><td class="hl-num" data-line="20"></td><td>        <span class="hl-k">end</span></td></tr>
<tr><td class="hl-num" data-line="21"></td><td>        lines[i] = current</td></tr>
<tr><td class="hl-num" data-line="22"></td><td>    <span class="hl-k">end</span></td></tr>
<tr><td class="hl-num" data-line="23"></td><td>    <span class="hl-k">return</span> lines</td></tr>
<tr><td class="hl-num" data-line="24"></td><td><span class="hl-k">end</span></td></tr>
<tr><td class="hl-num" data-line="25"></td><td></td></tr>
</tbody>
</table>